"use strict";(self.webpackChunkcolegio_web_angular=self.webpackChunkcolegio_web_angular||[]).push([[101],{4101:(R,g,i)=>{i.r(g),i.d(g,{DocenteCalificacionesPage:()=>j});var u=i(2200),l=i(9417),c=i(2615),e=i(3664),m=i(8034),f=i(8774);function p(n,s){1&n&&(e.j41(0,"div",6),e.EFF(1,"Cargando alumnos\u2026"),e.k0s())}function h(n,s){1&n&&(e.j41(0,"div",7),e.EFF(1,"No se pudieron cargar los datos."),e.k0s())}function b(n,s){if(1&n&&(e.j41(0,"th"),e.EFF(1),e.k0s()),2&n){const o=s.$implicit;e.R7$(),e.JRh(o)}}function E(n,s){if(1&n){const o=e.RV6();e.j41(0,"td")(1,"input",19),e.mxI("ngModelChange",function(t){const r=c.eBV(o).index,_=e.XpG().$implicit;return e.DH7(_.notas[r],t)||(_.notas[r]=t),c.Njj(t)}),e.bIt("ngModelChange",function(){c.eBV(o);const t=e.XpG().$implicit,r=e.XpG(3);return c.Njj(r.recalcular(t))}),e.k0s()()}if(2&n){const o=s.index,a=e.XpG().$implicit;e.R7$(),e.R50("ngModel",a.notas[o])}}function C(n,s){if(1&n&&(e.j41(0,"tr")(1,"td",17),e.EFF(2),e.k0s(),e.DNE(3,E,2,1,"td",16),e.j41(4,"td"),e.EFF(5),e.k0s(),e.j41(6,"td",18),e.EFF(7),e.k0s()()),2&n){const o=s.$implicit,a=e.XpG(3);e.R7$(2),e.Lme(" ",o.apellidos," ",o.nombres," "),e.R7$(),e.Y8G("ngForOf",a.tareas),e.R7$(2),e.SpI(" ",null!==o.promedio?o.promedio:"\u2014"," "),e.R7$(),e.Y8G("ngClass","Aprueba"===o.estado?"text-success fw-bold":"Reprueba"===o.estado?"text-danger fw-bold":""),e.R7$(),e.SpI(" ",o.estado||"\u2014"," ")}}function D(n,s){if(1&n&&(e.j41(0,"table",14)(1,"thead",15)(2,"tr")(3,"th"),e.EFF(4,"Estudiante"),e.k0s(),e.DNE(5,b,2,1,"th",16),e.j41(6,"th"),e.EFF(7,"Promedio"),e.k0s(),e.j41(8,"th"),e.EFF(9,"Estado"),e.k0s()()(),e.j41(10,"tbody"),e.DNE(11,C,8,6,"tr",16),e.k0s()()),2&n){const o=e.XpG(2);e.R7$(5),e.Y8G("ngForOf",o.tareas),e.R7$(6),e.Y8G("ngForOf",o.alumnos)}}function F(n,s){1&n&&(e.j41(0,"div",20),e.EFF(1," No hay alumnos registrados para este docente. "),e.k0s())}function P(n,s){if(1&n){const o=e.RV6();e.qex(0),e.j41(1,"div",8)(2,"div",9)(3,"button",10),e.bIt("click",function(){c.eBV(o);const t=e.XpG();return c.Njj(t.agregarTarea())}),e.EFF(4," Crear nueva tarea "),e.k0s(),e.j41(5,"button",11),e.bIt("click",function(){c.eBV(o);const t=e.XpG();return c.Njj(t.guardarCambios())}),e.EFF(6," Guardar cambios "),e.k0s()(),e.j41(7,"small",12),e.EFF(8," Por defecto tienes Tarea 1 y Tarea 2; puedes a\xf1adir m\xe1s tareas con el bot\xf3n. "),e.k0s()(),e.DNE(9,D,12,2,"table",13)(10,F,2,0,"ng-template",null,0,e.C5r),e.bVm()}if(2&n){const o=e.sdS(11),a=e.XpG();e.R7$(9),e.Y8G("ngIf",a.alumnos.length)("ngIfElse",o)}}let j=(()=>{var n;class s{constructor(a,t){this.alumnosSrv=a,this.auth=t,this.tareas=["Tarea 1","Tarea 2"],this.alumnos=[],this.cargando=!1,this.error=!1}ngOnInit(){const a=this.getDocenteId();this.cargarAlumnos(a)}getDocenteId(){const t=this.auth.currentUser?.username?.toLowerCase()||"";return"mariacabrera"===t?1:"carlosmolina"===t?2:"luispacheco"===t?3:(console.warn("getDocenteId: usuario no mapeado, usando 1 por defecto"),1)}cargarAlumnos(a){this.cargando=!0,this.error=!1,this.alumnosSrv.listarPorDocente(a).subscribe({next:t=>{const r=this.tareas.map(()=>null);this.alumnos=(t||[]).map(_=>({..._,notas:[...r],promedio:null,estado:""})),this.cargando=!1},error:t=>{console.error("[DocenteCalificaciones] error cargando alumnos",t),this.error=!0,this.cargando=!1}})}agregarTarea(){this.tareas.push(`Tarea ${this.tareas.length+1}`),this.alumnos.forEach(r=>{r.notas.push(null),this.recalcular(r)})}recalcular(a){const t=a.notas.filter(d=>null!=d);if(!t.length)return a.promedio=null,void(a.estado="");const _=t.reduce((d,I)=>d+Number(I),0)/t.length;a.promedio=Number(_.toFixed(2)),a.estado=_>=7?"Aprueba":"Reprueba"}guardarCambios(){const a={};for(const t of this.alumnos)a[String(t.id_alumno)]={id_alumno:t.id_alumno,nombre:`${t.apellidos} ${t.nombres}`,tareas:[...this.tareas],notas:[...t.notas],promedio:t.promedio,estado:t.estado};localStorage.setItem("colegio.calificaciones",JSON.stringify(a)),alert("Calificaciones guardadas en el registro del sistema \u2714")}static#e=n=()=>(this.\u0275fac=function(t){return new(t||s)(e.rXU(m.p),e.rXU(f.u))},this.\u0275cmp=e.VBU({type:s,selectors:[["app-docente-calificaciones"]],decls:6,vars:3,consts:[["sinAlumnos",""],[1,"container","mt-4"],[1,"mb-3"],["class","alert alert-info",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[4,"ngIf"],[1,"alert","alert-info"],[1,"alert","alert-danger"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"d-flex","gap-2"],[1,"btn","btn-sm","btn-outline-primary",3,"click"],[1,"btn","btn-sm","btn-success",3,"click"],[1,"text-muted"],["class","table table-bordered table-striped text-center",4,"ngIf","ngIfElse"],[1,"table","table-bordered","table-striped","text-center"],[1,"table-primary"],[4,"ngFor","ngForOf"],[1,"text-start"],[3,"ngClass"],["type","number","min","0","max","10","step","0.1",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"alert","alert-warning"]],template:function(t,r){1&t&&(e.j41(0,"div",1)(1,"h2",2),e.EFF(2,"Registro de Calificaciones"),e.k0s(),e.DNE(3,p,2,0,"div",3)(4,h,2,0,"div",4)(5,P,12,2,"ng-container",5),e.k0s()),2&t&&(e.R7$(3),e.Y8G("ngIf",r.cargando),e.R7$(),e.Y8G("ngIf",r.error),e.R7$(),e.Y8G("ngIf",!r.cargando&&!r.error))},dependencies:[u.MD,u.YU,u.Sq,u.bT,l.YN,l.me,l.Q0,l.BC,l.VZ,l.zX,l.vS],encapsulation:2}))}return n(),s})()}}]);