{"ast":null,"code":"import { tap, of } from 'rxjs';\nimport { environment } from '../../environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nconst TOKEN_KEY = 'colegio.token';\nconst USER_KEY = 'colegio.user';\nexport let AuthService = /*#__PURE__*/(() => {\n  var _staticBlock;\n  class AuthService {\n    constructor(http) {\n      this.http = http;\n      this.loginUrl = `${environment.apiBase}/auth/login`;\n      this.currentUser = null;\n      // Recuperar sesiÃ³n si ya estaba logueado\n      const raw = localStorage.getItem(USER_KEY);\n      if (raw) {\n        try {\n          this.currentUser = JSON.parse(raw);\n        } catch {\n          this.currentUser = null;\n        }\n      }\n    }\n    /** ðŸ”¹ Login: puede ser FALSO (para pruebas) o REAL (contra backend) */\n    login(username, password) {\n      username = username.trim();\n      // ðŸ‘‰ MODO FAKE (para probar sin backend)\n      if (environment.useFakeAuth) {\n        const rol = this.inferRol(username);\n        const fakeResp = {\n          token: 'FAKE_TOKEN',\n          type: 'Bearer',\n          username,\n          rol: {\n            nombre: rol\n          }\n        };\n        return of(fakeResp).pipe(tap(res => this.handleLoginResponse(res)));\n      }\n      // ðŸ‘‰ MODO REAL (backend Spring)\n      const body = {\n        username,\n        password\n      };\n      return this.http.post(this.loginUrl, body).pipe(tap(res => this.handleLoginResponse(res)));\n    }\n    /** ðŸ”¹ Procesa la respuesta del backend (o fake) */\n    handleLoginResponse(res) {\n      const rolNombre = res.rol?.nombre;\n      const session = {\n        username: res.username,\n        rol: rolNombre\n      };\n      this.currentUser = session;\n      localStorage.setItem(TOKEN_KEY, res.token);\n      localStorage.setItem(USER_KEY, JSON.stringify(session));\n    }\n    /** ðŸ”¹ Determina rol en modo fake segÃºn el usuario */\n    inferRol(username) {\n      const u = username.toLowerCase();\n      if (u === 'admin') return 'ADMIN';\n      if (u === 'mariacabrera' || u === 'carlosmolina' || u === 'luispacheco') {\n        return 'DOCENTE';\n      }\n      // el resto como ALUMNO\n      return 'ALUMNO';\n    }\n    /** ðŸ”¹ Devuelve el token para el interceptor */\n    getToken() {\n      return localStorage.getItem(TOKEN_KEY);\n    }\n    /** ðŸ”¹ Cerrar sesiÃ³n */\n    logout() {\n      localStorage.removeItem(TOKEN_KEY);\n      localStorage.removeItem(USER_KEY);\n      this.currentUser = null;\n    }\n    isLoggedIn() {\n      return !!this.getToken();\n    }\n    /** ðŸ”¹ Lo usan tus guards */\n    hasRole(rol) {\n      return this.currentUser?.rol === rol;\n    }\n    static #_ = _staticBlock = () => (this.Éµfac = function AuthService_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || AuthService)(i0.ÉµÉµinject(i1.HttpClient));\n    }, this.Éµprov = /*@__PURE__*/i0.ÉµÉµdefineInjectable({\n      token: AuthService,\n      factory: AuthService.Éµfac,\n      providedIn: 'root'\n    }));\n  }\n  _staticBlock();\n  return AuthService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}